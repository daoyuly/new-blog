---
title: 代码重构
tags: 代码重构
abbrlink: 41346
date: 2008-02-04 10:28:00
---

在没有具体阅读《重构》之前，我认为重构就是将代码变的容易理解，容易维护，但在阅读了《重构》之后才发现重构不仅可以利用到重新构造已有的代码，也可以帮助我们在阅读代码的过程中增加我们的对代码理解的速度。其实我想每个学习编写代码的同行都在学习的过程中阅读过别人的代码，然后还有可能将别人的代码拿到计算机上编译运行来查看结果表现。实际上我认为这在某种意义上属于重构，只是重构的粒度有多大，或许你修改别人的代码一部分来查看修改的结果，从而帮助自己掌握软件中的更多特性。Martin Flower说的就是如此，我们如果没有得到别人完整的文档，那我们怎么样才能理解别人的代码来，好的办法就是我们一边阅读别人的代码，一边部分部分的修改他人的代码，然后测试每次修改的结果与以前的结果是否一样，如果一样，那么你的重构代码是正确，那么你肯定能够理解你自己写的代码吧（自己都不理解自己的代码就不要干了）；别人的代码就这样在我们一部分一部分修改当中被我们理解了。

以前我们写代码的时候喜欢设计，设计的我们认为很详细，然后开始将所有的功能一下子写完，接着就是调试了，在调试的过程中我们可能花费比写代码长的多的时间。是的，因为你在运行一个复杂的东西，当然不容易搞定了。Martin Flower认为我们调试的时间可以不用那么长，原因是我们不能在写完了一个复杂系统的时候再调试，我们可以先建立一个好的测试用例，在写这个测试用例的过程中我们更能对整个系统了解，也能够帮助我们写代码；然后我们一点点的写，写一部分测试一下，保证每次新写的代码都能正确运行，从而当代码写完了，系统调试也完毕了。这样的情况下可以认为我们没有在调试上花时间，我们把时间花在测试和编写代码上了。

以前认为代码当中注释越多越好。Martin Flower又一次给我们教训说，写注释是因为你的代码已经不能告诉代码阅读者他的真实意思了。是的，好的代码可以通过很多方式来表达其本身的含义，例如变量的名称，函数的名称等，就比如一个条件判断来说，我们给这个即使很短的条件判断上抽取一个方法来告诉读者，这个判断的真实意义，比直接使用即使很短的判断好。那么重构可以得到这个目的，于是让我们重构吧。

在之前我也认为重构会花费很大代码，因为我们要理解代码，重新编写；但为了修改BUG，Martin Flower告诉我们重构是最快的。也许不相信，我也不相信，但他说的有道理，容易修改的BUG，当然早就被修改了，那么剩下的BUG就很难找了，主要因为代码中的逻辑不清楚，重构可以改变这种情况，让我们的代码有条有理，那么当然BUG就无处藏身了。
勇于接受变化。以前认为用户频繁的变化需求是不可理喻，实际上是我们自己不可理喻，他们花钱当然需要能提供高质量的服务；而Martin Flower认为不用怕改变，我们有重构工具，重构可以让我们代码任何时候都是清楚的，容易修改的，那么变化是件快乐的事情不再象以前那样艰难了。

重构与性能不是是对立的。重构让代码容易理解，而性能让代码变的难以理解，不过我们在开始的时候应该考虑怎么样让代码容易理解和维护，这样我们可以在后面适当的时候对代码的某部分进行轻松的性能改进工作，因此他们不是对立的，性能以重构为基础的。

其实通过《重构》，最主要的目的是让我们的代码更清晰，更轻巧，更容易被维护，那么也就是我们有良好的代码，于是我们还惧怕什么，什么都可以轻松搞定。